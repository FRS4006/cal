<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1; height=device-height, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity= "sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
      body{
        min-width:500px;
        width: auto;
        /* width:1000px; */
      }

      li{
        border-color: black;
      }
      .box {
        position: relative;
        width: 10vh;		/* desired width */
      }
      .box:before {
        content: "";
        float: left;
        padding-top: 10vh; 	/* initial ratio of 1:1*/
        border: .5vh black;

      }
      .content {
        float: left;
      }
      .black-box{
        background-color: black;
        text-align: center;
      }
      a{
        color: white;
      }
    </style>
  </head>
  <body>
          <div class="calendar">
            <div class ="text-center">
              <div class="row">
                <div class="col">
                  <form method="post" action="{% url 'previous' previous_month=previous_month selected_year=selected_year %}">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" name="previous">Previous</button>
                  </form>
                </div>
                <div class="col">
                  <h1>{{selected_month}} / {{selected_year}}</h1>
                </div>
                <div class="col">
                  <form method="post" action="{% url 'next' next_month=next_month selected_year=selected_year %}">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" name="next" >Next</button>
                  </form>
                </div>
              </div>
            </div>
            <div class = "row">
                <div class = "col box">
                  <li class= "list-group-item list-group-item-primary"> Support </li>
                </div>
                <div class = "col box">
                  <li class= "list-group-item list-group-item-danger"> Friendship</li>
                </div>
                <div class = "col box">
                  <li class= "list-group-item list-group-item-secondary"> Health </li>
                </div>
            </div>
              <ul class="weekdays">
                <div class="row align-items-center row-eq-height">
                  <div class = "col">
                    <li> Su </li>
                  </div>
                  <div class = "col">
                    <li> M </li>
                  </div>
                  <div class = "col">
                    <li> Tu </li>
                  </div>
                  <div class = "col">
                    <li> W </li>
                  </div>
                  <div class = "col">
                    <li> Th </li>
                  </div>
                  <div class = "col">
                    <li> F </li>
                  </div>
                  <div class = "col">
                    <li> Sa </li>
                  </div>
                </div>
              </ul>
              <div class = "row">
                {% for day in first_week %}
                  {% if day.event == "Support" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-primary"> {{day.day}}</li>
                    </div>
                  {% elif day.event == "Friendship" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-danger"> {{day.day}} </li>
                    </div>
                  {% elif day.event == "Health" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-secondary"> 
                        {{day.day}}
                      </li>
                    </div>
                  {% else %}
                    <div class = "col">
                      <li id={{day.day}}_{{day.month}} class= "list-group-item"> {{day.day}}</li>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
              <div class = "row">
                {% for day in second_week %}
                  {% if day.event == "Support" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-primary"> {{day.day}}</li>
                    </div>
                  {% elif day.event == "Friendship" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-danger"> {{day.day}} </li>
                    </div>
                  {% elif day.event == "Health" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-secondary"> 
                        {{day.day}}
                      </li>
                    </div>
                  {% else %}
                    <div class = "col">
                      <li id={{day.day}}_{{day.month}} class= "list-group-item"> {{day.day}}</li>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
              <div class = "row">
                {% for day in third_week %}
                  {% if day.event == "Support" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-primary"> {{day.day}}</li>
                    </div>
                  {% elif day.event == "Friendship" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-danger"> {{day.day}} </li>
                    </div>
                  {% elif day.event == "Health" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-secondary"> 
                        {{day.day}}
                      </li>
                    </div>
                  {% else %}
                    <div class = "col">
                      <li id={{day.day}}_{{day.month}} class= "list-group-item"> {{day.day}}</li>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
              <div class = "row">
                {% for day in fourth_week %}
                  {% if day.event == "Support" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-primary"> {{day.day}}</li>
                    </div>
                  {% elif day.event == "Friendship" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-danger"> {{day.day}} </li>
                    </div>
                  {% elif day.event == "Health" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-secondary"> 
                        {{day.day}}
                      </li>
                    </div>
                  {% else %}
                    <div class = "col">
                      <li id={{day.day}}_{{day.month}} class= "list-group-item"> {{day.day}}</li>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
              <div class = "row">
                {% for day in fifth_week %}
                  {% if day.event == "Support" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-primary"> {{day.day}}</li>
                    </div>
                  {% elif day.event == "Friendship" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-danger"> {{day.day}} </li>
                    </div>
                  {% elif day.event == "Health" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-secondary"> 
                        {{day.day}}
                      </li>
                    </div>
                  {% else %}
                    <div class = "col">
                      <li id={{day.day}}_{{day.month}} class= "list-group-item"> {{day.day}}</li>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
              <div class = "row">
                {% for day in sixth_week %}
                  {% if day.event == "Support" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-primary"> {{day.day}}</li>
                    </div>
                  {% elif day.event == "Friendship" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-danger"> {{day.day}} </li>
                    </div>
                  {% elif day.event == "Health" %}
                    <div class = "col">
                      <li data-bs-toggle="modal" data-bs-target="#exampleModal" id={{day.day}}_{{day.month}} class= "list-group-item list-group-item-secondary"> 
                        {{day.day}}
                      </li>
                    </div>
                  {% else %}
                    <div class = "col">
                      <li id={{day.day}}_{{day.month}} class= "list-group-item"> {{day.day}}</li>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
          </div>


        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h3 class="modal-title" id="modal_title"></h3>
              </div>
              <div class="modal-body">
                <ul>
                  <div id="modal_date"> <i class="bi bi-calendar"></i> </div>
                  <div id="modal_time"> <i class="bi bi-clock"></i> </div>
                  <div id="modal_location"> <i class="bi bi-geo-alt"></i> </div>
                </ul>
                <div id="modal_desc"></div>
                <br>
                <div class = "black-box">
                  <a id="modal_link" href="#"></a>
                </div>
              </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script>
          
          var modal_link = document.getElementById('modal_link');
          var modal_location = document.getElementById('modal_location');
          var modal_title = document.getElementById('modal_title');
          var modal_date = document.getElementById('modal_date');
          var modal_desc = document.getElementById('modal_desc');
          var modal_link = document.getElementById('modal_link');

          function isElementClicked(id){
            var test = id.split("_")
            // the ID's are constructed of day_month, so this seperates those numbers
            console.log(test[0], test[1])
            var display = {{json_display_events|safe}};



            // console.log(display[0].day)
            for(let i = 0; i < display.length; i++){
              if(display[i].day == test[0] && display[i].month == test[1]){
                console.log(display[i]);

                var title = display[i].title;
                var title_text = document.createTextNode(title);
                modal_title.innerHTML = '';
                modal_title.appendChild(title_text);

                var date = display[i].display_date;
                var date_text = document.createTextNode(date);
                modal_date.innerHTML = '<i class="bi bi-calendar"></i> ';
                modal_date.appendChild(date_text);

                var time = display[i].display_hour;
                var time_text = document.createTextNode(time);
                modal_time.innerHTML = '<i class="bi bi-clock"></i> ';
                modal_time.appendChild(time_text);

                var location = display[i].location;
                var location_text = document.createTextNode(location);
                modal_location.innerHTML = '<i class="bi bi-geo-alt"></i> ';
                modal_location.appendChild(location_text);

                if(display[i].description != null){
                  var desc = display[i].description;
                  var desc_text = document.createTextNode(desc);
                  modal_desc.innerHTML = '';
                  modal_desc.appendChild(desc_text);
                }
                else{
                  modal_desc.innerHTML = '';
                }

                if(display[i].link != ""){
                  var link = display[i].link;
                  var link_text = document.createTextNode(link);
                  modal_link.innerHTML = '';
                  modal_link.href = link;
                  modal_link.appendChild(link_text);
                }
                else{
                  modal_link.innerHTML = '';
                }
              }
            }
          }
    
          var testclick = document.querySelectorAll("li");
          for(let i = 0; i < testclick.length; i++){
            // for each list item
            if(testclick[i].id != ""){
              // if it has an id, give it an event listener for when it is clicked
              testclick[i].addEventListener("click", function(){
                isElementClicked(testclick[i].id);
              }); 
            }
          }
        </script>
      </body>
</html>